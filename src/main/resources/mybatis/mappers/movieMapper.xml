<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="movieMapper">
  
  	<!-- 영화선택 -->
  	<select id="movieTitleSelect" resultType="MovieInfoVO">
  	select movieinfo_num, movieinfo_title, movieinfo_grade
    from movieinfo
  	</select>
  
  	<!-- 영화지역 선택 -->
  	<select id="movieLocSelect" resultType="CinemaVO">
  	select DISTINCT cinema_loc, cinema_locnum
  	from cinema
	order by cinema_locnum asc
  	</select>
  	
  	
  	<!-- 영화지역에 따른 관 선택 -->
  	<select id="movieCinemaSelect" parameterType="ChoiceVO" resultType="CinemaVO">
  	select distinct cinema_name, cinema_num
    from cinema
    where cinema_loc = #{cinema_loc}
    order by cinema_num asc
  	</select>
  	
  	<!-- 선택한 영화 지역 보여주기  -->
  	<select id="movieChoice" parameterType="ChoiceVO" resultType="ChoiceVO">
  	select distinct cinema_name, count(cinema_name) cinema_num
    from cinema A full outer join timeinfo B
    on A.cinema_num = B.cinema_num
    where A.cinema_loc = #{cinema_loc} and B.movieinfo_num = #{movieInfo_num}
    group by cinema_name
    order by cinema_name asc
<!-- select  distinct cinema_name, count(cinema_name) cinema_num
    from cinema A full outer join (
    select * from theater B full outer join timeinfo C 
    on B.theater_num = C.theater_num) D
    on A.cinema_num = D.cinema_num
    where A.cinema_loc = #{cinema_loc} and D.movieinfo_num  = #{movieInfo_num}
    group by cinema_name
    order by cinema_name asc -->
  	</select>

  	<!-- theater num 받기 -->
  	<select id="theaterSelect" parameterType="ChoiceVO" resultType="ChoiceVO">
  	select distinct theater_num 
    from timeinfo
    where movieinfo_num = #{movieInfo_num} and cinema_num = #{cinema_num}
  	</select>
  	
  	
  	<!-- 날짜 선택하기 -->	
  	<select id="movieDateSelect" parameterType="ChoiceVO" resultType="TimeInfoVO">
  	select distinct B.timeinfo_date, A.theater_num
	from theater A full outer Join timeinfo B
	on A.theater_num = B.theater_num
	where A.cinema_num = #{cinema_num} and B.movieinfo_num = #{movieInfo_num} 
	order by B.timeinfo_date asc
  	</select>
  	
  	<select id="movieTimeSelect" parameterType="ChoiceVO" resultType="TimeInfoVO">
	select B.timeinfo_start, B.timeinfo_date
	from theater A full outer Join timeinfo B
	on A.theater_num = B.theater_num
	where A.cinema_num = #{cinema_num} and B.movieinfo_num = #{movieInfo_num} and B.timeinfo_date = #{timeInfo_date}
	order by B.timeinfo_start asc
  	</select>
  	
  	<!-- 좌석 -->
  	<select id="seatCount" parameterType="ChoiceVO" resultType="ChoiceVO">
  	select timeinfo_start, count(*) seatCount
    from seat
    where movieinfo_num = #{movieInfo_num} and cinema_num = #{cinema_num}
    group by timeinfo_start
    order by timeinfo_start asc
  	</select>

  	
  	<!-- DATABASE에 값 넣기 -->
  	<!-- A -->
  	<insert id="timeInfoInsert" parameterType="TimeInfoVO">
	insert into timeinfo
	values (timeinfo_seq.nextval,
	
	#{theater_num}, 
	#{movieInfo_num},
	
	to_date('19-12-01', 'yy-mm-dd'),
	to_date('19-12-01 20:00', 'yy-mm-dd HH24:MI'),
	to_date((select to_char(to_date('19-12-01 20:00', 'yy-mm-dd hh24:mi') +
	(1/24/60)*(select movieinfo_time from movieinfo where movieinfo_num
	
	= #{movieInfo_num})
	
	,'yy-mm-dd HH24:MI') from dual), 'yy-mm-dd HH24:MI'))
  	</insert>

	<!-- A -->
	<insert id="timeInfoInsertA" parameterType="TimeInfoVO">
		insert all
		into timeinfo
		values (timeinfo_seq.nextval,
		#{theater_num}, 
		#{movieInfo_num},
		to_date('19-12-01', 'yy-mm-dd'),
		to_date('19-12-01 08:00', 'yy-mm-dd HH24:MI'),
		to_date((select to_char(to_date('19-12-01 08:00', 'yy-mm-dd hh24:mi') +
		(1/24/60)*(select movieinfo_time from movieinfo where movieinfo_num
		= #{movieInfo_num})
		,'yy-mm-dd HH24:MI') from dual), 'yy-mm-dd HH24:MI'))

		into timeinfo
		values (timeinfo_seq.nextval +1 ,
		#{theater_num}, 
		#{movieInfo_num},
		to_date('19-12-01', 'yy-mm-dd'),
		to_date('19-12-01 11:00', 'yy-mm-dd HH24:MI'),
		to_date((select to_char(to_date('19-12-01 11:00', 'yy-mm-dd hh24:mi') +
		(1/24/60)*(select movieinfo_time from movieinfo where movieinfo_num
		= #{movieInfo_num})
		,'yy-mm-dd HH24:MI') from dual), 'yy-mm-dd HH24:MI'))

		into timeinfo
		values (timeinfo_seq.nextval +2,
		#{theater_num}, 
		#{movieInfo_num},
		to_date('19-12-01', 'yy-mm-dd'),
		to_date('19-12-01 14:00', 'yy-mm-dd HH24:MI'),
		to_date((select to_char(to_date('19-12-01 14:00', 'yy-mm-dd hh24:mi') +
		(1/24/60)*(select movieinfo_time from movieinfo where movieinfo_num
		= #{movieInfo_num})
		,'yy-mm-dd HH24:MI') from dual), 'yy-mm-dd HH24:MI'))

		into timeinfo
		values (timeinfo_seq.nextval +3,
		#{theater_num}, 
		#{movieInfo_num},
		to_date('19-12-01', 'yy-mm-dd'),
		to_date('19-12-01 17:00', 'yy-mm-dd HH24:MI'),
		to_date((select to_char(to_date('19-12-01 17:00', 'yy-mm-dd hh24:mi') +
		(1/24/60)*(select movieinfo_time from movieinfo where movieinfo_num
		= #{movieInfo_num})
		,'yy-mm-dd HH24:MI') from dual), 'yy-mm-dd HH24:MI'))

		into timeinfo
		values (timeinfo_seq.nextval +4,
		#{theater_num}, 
		#{movieInfo_num},
		to_date('19-12-01', 'yy-mm-dd'),
		to_date('19-12-01 20:00', 'yy-mm-dd HH24:MI'),
		to_date((select to_char(to_date('19-12-01 20:00', 'yy-mm-dd hh24:mi') +
		(1/24/60)*(select movieinfo_time from movieinfo where movieinfo_num
		= #{movieInfo_num}
		),'yy-mm-dd HH24:MI') from dual), 'yy-mm-dd HH24:MI'))

		select * from dual
	</insert>
  	
  	
  	
  	<!-- B -->
<insert id="timeInfoInsertB" parameterType="TimeInfoVO">
		insert all
		into timeinfo
		values (timeinfo_seq.nextval,
		#{theater_num}, 
		#{movieInfo_num},
		to_date('19-12-01', 'yy-mm-dd'),
		to_date('19-12-01 09:00', 'yy-mm-dd HH24:MI'),
		to_date((select to_char(to_date('19-12-01 09:00', 'yy-mm-dd hh24:mi') +
		(1/24/60)*(select movieinfo_time from movieinfo where movieinfo_num
		= #{movieInfo_num})
		,'yy-mm-dd HH24:MI') from dual), 'yy-mm-dd HH24:MI'))

		into timeinfo
		values (timeinfo_seq.nextval +1 ,
		#{theater_num}, 
		#{movieInfo_num},
		to_date('19-12-01', 'yy-mm-dd'),
		to_date('19-12-01 12:00', 'yy-mm-dd HH24:MI'),
		to_date((select to_char(to_date('19-12-01 12:00', 'yy-mm-dd hh24:mi') +
		(1/24/60)*(select movieinfo_time from movieinfo where movieinfo_num
		= #{movieInfo_num})
		,'yy-mm-dd HH24:MI') from dual), 'yy-mm-dd HH24:MI'))

		into timeinfo
		values (timeinfo_seq.nextval +2,
		#{theater_num}, 
		#{movieInfo_num},
		to_date('19-12-01', 'yy-mm-dd'),
		to_date('19-12-01 15:00', 'yy-mm-dd HH24:MI'),
		to_date((select to_char(to_date('19-12-01 15:00', 'yy-mm-dd hh24:mi') +
		(1/24/60)*(select movieinfo_time from movieinfo where movieinfo_num
		= #{movieInfo_num})
		,'yy-mm-dd HH24:MI') from dual), 'yy-mm-dd HH24:MI'))

		into timeinfo
		values (timeinfo_seq.nextval +3,
		#{theater_num}, 
		#{movieInfo_num},
		to_date('19-12-01', 'yy-mm-dd'),
		to_date('19-12-01 18:00', 'yy-mm-dd HH24:MI'),
		to_date((select to_char(to_date('19-12-01 18:00', 'yy-mm-dd hh24:mi') +
		(1/24/60)*(select movieinfo_time from movieinfo where movieinfo_num
		= #{movieInfo_num})
		,'yy-mm-dd HH24:MI') from dual), 'yy-mm-dd HH24:MI'))

		into timeinfo
		values (timeinfo_seq.nextval +4,
		#{theater_num}, 
		#{movieInfo_num},
		to_date('19-12-01', 'yy-mm-dd'),
		to_date('19-12-01 21:00', 'yy-mm-dd HH24:MI'),
		to_date((select to_char(to_date('19-12-01 21:00', 'yy-mm-dd hh24:mi') +
		(1/24/60)*(select movieinfo_time from movieinfo where movieinfo_num
		= #{movieInfo_num}
		),'yy-mm-dd HH24:MI') from dual), 'yy-mm-dd HH24:MI'))

		select * from dual
	</insert>  	
  	
  	
  	<!-- C -->
<insert id="timeInfoInsertC" parameterType="TimeInfoVO">
		insert all
		into timeinfo
		values (timeinfo_seq.nextval,
		#{theater_num}, 
		#{movieInfo_num},
		to_date('19-12-01', 'yy-mm-dd'),
		to_date('19-12-01 10:00', 'yy-mm-dd HH24:MI'),
		to_date((select to_char(to_date('19-12-01 10:00', 'yy-mm-dd hh24:mi') +
		(1/24/60)*(select movieinfo_time from movieinfo where movieinfo_num
		= #{movieInfo_num})
		,'yy-mm-dd HH24:MI') from dual), 'yy-mm-dd HH24:MI'))

		into timeinfo
		values (timeinfo_seq.nextval +1 ,
		#{theater_num}, 
		#{movieInfo_num},
		to_date('19-12-01', 'yy-mm-dd'),
		to_date('19-12-01 13:00', 'yy-mm-dd HH24:MI'),
		to_date((select to_char(to_date('19-12-01 13:00', 'yy-mm-dd hh24:mi') +
		(1/24/60)*(select movieinfo_time from movieinfo where movieinfo_num
		= #{movieInfo_num})
		,'yy-mm-dd HH24:MI') from dual), 'yy-mm-dd HH24:MI'))

		into timeinfo
		values (timeinfo_seq.nextval +2,
		#{theater_num}, 
		#{movieInfo_num},
		to_date('19-12-01', 'yy-mm-dd'),
		to_date('19-12-01 16:00', 'yy-mm-dd HH24:MI'),
		to_date((select to_char(to_date('19-12-01 16:00', 'yy-mm-dd hh24:mi') +
		(1/24/60)*(select movieinfo_time from movieinfo where movieinfo_num
		= #{movieInfo_num})
		,'yy-mm-dd HH24:MI') from dual), 'yy-mm-dd HH24:MI'))

		into timeinfo
		values (timeinfo_seq.nextval +3,
		#{theater_num}, 
		#{movieInfo_num},
		to_date('19-12-01', 'yy-mm-dd'),
		to_date('19-12-01 19:00', 'yy-mm-dd HH24:MI'),
		to_date((select to_char(to_date('19-12-01 19:00', 'yy-mm-dd hh24:mi') +
		(1/24/60)*(select movieinfo_time from movieinfo where movieinfo_num
		= #{movieInfo_num})
		,'yy-mm-dd HH24:MI') from dual), 'yy-mm-dd HH24:MI'))

		into timeinfo
		values (timeinfo_seq.nextval +4,
		#{theater_num}, 
		#{movieInfo_num},
		to_date('19-12-01', 'yy-mm-dd'),
		to_date('19-12-01 22:00', 'yy-mm-dd HH24:MI'),
		to_date((select to_char(to_date('19-12-01 22:00', 'yy-mm-dd hh24:mi') +
		(1/24/60)*(select movieinfo_time from movieinfo where movieinfo_num
		= #{movieInfo_num}
		),'yy-mm-dd HH24:MI') from dual), 'yy-mm-dd HH24:MI'))

		select * from dual
	</insert>  
  	
  	<update id="seq_plus">
  		alter sequence timeinfo_seq increment by +5
  	</update>
  	
  	
  	
  
  
  </mapper>